---
- name: Install pacakages
  apt:
    name:
      - syncthing
  become: true

- name: enable syncthing service
  service:
    name: syncthing@aragorn.service
    enabled: yes
  become: true

- name: start syncthing service
  service:
    name: syncthing@aragorn.service
    state: started
  become: true

- name: change GUI address
  lineinfile:
    path: /home/aragorn/.config/syncthing/config.xml
    regexp: '^        \<address'
    line: '        <address>0.0.0.0:8384</address>'
  become: true
  notify: restart syncthing

- name: copy https certs
  copy:
    src: "{{ item.from }}"
    dest: "{{ item.to }}"
    owner: aragorn
    group: aragorn
    mode: 0600
  loop:
    - { from: '{{ dist.cert }}/{{ cert.star_pem }}', to: '/home/aragorn/.config/syncthing/https-key.pem'}
    - { from: '{{ dist.cert }}/{{ cert.star_fc }}', to: '/home/aragorn/.config/syncthing/https-cert.pem'}
  become: true

- name: enable tls in config
  lineinfile:
    path: /home/aragorn/.config/syncthing/config.xml
    regexp: '^    <gui'
    line: '    <gui enabled="true" tls="false" debugging="false">'
  become: true
  notify: restart syncthing